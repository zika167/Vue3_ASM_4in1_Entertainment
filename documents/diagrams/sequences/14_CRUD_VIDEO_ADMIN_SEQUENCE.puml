@startuml
skinparam backgroundColor #FEFEFE
skinparam sequenceMessageAlign center

title CRUD Video (Admin) - Sequence Diagram\n4in1 Video Sharing Application

actor "Admin" as Admin
participant "Vue Component\n(AdminVideoPage)" as Vue
participant "VideoService\n(Factory)" as VideoFactory
participant "JavaVideoService" as VideoService
participant "apiClient\n(Axios)" as Axios
participant "VideoAPI\n(Servlet)" as API
participant "VideoServiceImpl" as Service
participant "VideoRepo" as Repo
database "Database" as DB

== CREATE Video ==

Admin -> Vue : Fill video form\nClick "Tao video"
activate Vue

Vue -> Vue : Validate form\n- title required\n- poster URL valid

Vue -> VideoFactory : create(videoData)
activate VideoFactory

note right of VideoFactory
    videoData = {
        id: "vid123",
        title: "Video Title",
        poster: "poster.jpg",
        description: "...",
        active: true,
        userId: "admin001"
    }
end note

VideoFactory -> VideoService : create(data)
activate VideoService

VideoService -> Axios : POST /api/videos\n{videoData}
activate Axios

Axios -> API : HTTP POST Request
activate API

API -> Service : create(VideoRequest)
activate Service

Service -> Service : Validate input
Service -> Service : Create Video entity\nSet createdDate, updatedDate

Service -> Repo : save(video)
activate Repo
Repo -> DB : INSERT INTO Video VALUES(...)
DB --> Repo : Success
Repo --> Service : Video saved
deactivate Repo

Service --> API : VideoResponse
deactivate Service

API --> Axios : 201 Created\n{success: true, data: video}
deactivate API

Axios --> VideoService : Response
deactivate Axios

VideoService --> VideoFactory : {success: true, data}
deactivate VideoService

VideoFactory --> Vue : {success: true, data}
deactivate VideoFactory

Vue --> Admin : Hien thi "Tao video thanh cong"\nRefresh list

deactivate Vue

== UPDATE Video ==

Admin -> Vue : Edit video\nClick "Cap nhat"
activate Vue

Vue -> VideoFactory : update(videoId, videoData)
activate VideoFactory

VideoFactory -> VideoService : update(id, data)
activate VideoService

VideoService -> Axios : PUT /api/videos/{videoId}\n{videoData}
activate Axios

Axios -> API : HTTP PUT Request
activate API

API -> Service : update(id, VideoRequest)
activate Service

Service -> Repo : findById(id)
activate Repo
Repo -> DB : SELECT * FROM Video WHERE id = ?
DB --> Repo : Video
Repo --> Service : Video entity
deactivate Repo

alt Video Not Found
    Service --> API : throw AppException(NOT_FOUND)
    API --> Axios : 404 Not Found
    Axios --> VideoService : Error
    VideoService --> VideoFactory : {success: false}
    VideoFactory --> Vue : Error
    Vue --> Admin : Hien thi "Video khong ton tai"
else Video Found
    Service -> Service : Update fields\nSet updatedDate = now()
    
    Service -> Repo : update(video)
    activate Repo
    Repo -> DB : UPDATE Video SET ... WHERE id = ?
    DB --> Repo : Success
    Repo --> Service : Updated
    deactivate Repo
    
    Service --> API : VideoResponse
    deactivate Service
    
    API --> Axios : 200 OK\n{success: true, data: video}
    deactivate API
    
    Axios --> VideoService : Response
    deactivate Axios
    
    VideoService --> VideoFactory : {success: true, data}
    deactivate VideoService
    
    VideoFactory --> Vue : {success: true, data}
    deactivate VideoFactory
    
    Vue --> Admin : Hien thi "Cap nhat thanh cong"
end

deactivate Vue

== DELETE Video ==

Admin -> Vue : Click "Xoa" on video\nConfirm delete
activate Vue

Vue -> VideoFactory : delete(videoId)
activate VideoFactory

VideoFactory -> VideoService : delete(videoId)
activate VideoService

VideoService -> Axios : DELETE /api/videos/{videoId}
activate Axios

Axios -> API : HTTP DELETE Request
activate API

API -> Service : delete(videoId)
activate Service

Service -> Repo : findById(videoId)
activate Repo
Repo -> DB : SELECT * FROM Video WHERE id = ?
DB --> Repo : Video
Repo --> Service : Video
deactivate Repo

Service -> Repo : delete(videoId)
activate Repo
Repo -> DB : DELETE FROM Video WHERE id = ?
DB --> Repo : Success
Repo --> Service : Deleted
deactivate Repo

Service --> API : true
deactivate Service

API --> Axios : 204 No Content\n{success: true}
deactivate API

Axios --> VideoService : Response
deactivate Axios

VideoService --> VideoFactory : {success: true}
deactivate VideoService

VideoFactory --> Vue : {success: true}
deactivate VideoFactory

Vue -> Vue : Remove video from list
Vue --> Admin : Hien thi "Xoa video thanh cong"

deactivate Vue

@enduml
